# It is a good practice to update your EC2 instance with the latest security updates
sudo apt update -y
sudo apt upgrade -y
# You'll need ffmpeg installed for Owncast to work with video segments. You'll need unzip to unpack the Owncast application you'll download
sudo apt install ffmpeg unzip -y

# Use the /home/ubuntu folder (should be the current folder when you log into the instance with the ubuntu user)

# Check out the latest version of the Owncast release
sudo wget https://github.com/owncast/owncast/releases/download/v0.2.3/owncast-0.2.3-linux-64bit.zip
sudo unzip owncast-0.2.3-linux-64bit.zip
sudo chmod +x owncast
sudo rm owncast-0.2.3-linux-64bit.zip

# This is the Owncast service declaration, required to run Owncast as a service whenever the EC2 instance is powered on
cat <<EOT | sudo tee /etc/systemd/system/owncast.service > /dev/null
[Unit]
Description=Owncast Streaming Server
After=network.target
[Service]
Type=simple
WorkingDirectory=/home/ubuntu
ExecStart=/home/ubuntu/owncast
Restart=on-failure
User=ubuntu
[Install]
WantedBy=multi-user.target
EOT

sudo systemctl daemon-reload
sudo systemctl enable owncast
sudo systemctl start owncast

# The first time you access using /admin, use the following access:
# User: Admin
# Password: abc123
# Change the password on first access, this can be done by accessing the Configuration -> General menu, Server Config tab
# Add a new Stream Key in Confiugration -> General, Stream Keys tab and then remove the default Key
# Configure S3 in Configuration -> General, S3 Object Storage tab, with the following information:
# Endpoint: https://s3.[THE_REGION_YOU_SELECTED_FOR_YOUR_OWNCAST_S3_BUCKET].amazonaws.com
# Access Key: Owncast User Access Key you created
# Secret Key: Owncast User's Secret Key you created
# Bucket: [THE_NAME_OF_YOUR_OWNCAST_BUCKET]
# Region: [THE_REGION_YOU_SELECTED_FOR_YOUR_OWNCAST_S3_BUCKET]
# In Optional Settings, fill the ACL field with the value "private" (without quotes)